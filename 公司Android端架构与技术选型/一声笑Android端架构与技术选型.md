![logo](https://i.imgur.com/DyZZ5vE.png)

# 一声笑Android端架构与技术选型

## 摘要

* [前言](#前言)
* [开发环境](#开发环境)
  * [IDE](#IDE)
  * [工具插件](#工具插件)
* [规范](#规范)
* [Android技术栈](#Android技术栈)
  * [Gradle构建](#Gradle构建)
  * [组件化](#组件化)
  * [模块化](#模块化)
  * [MVP模式](#MVP模式)
  * [UI框架](#UI框架)
  * [依赖](#依赖)
* [代码管理](#代码管理)
* [前后端分离](#前后端分离)
* [建议](#建议)

### 前言
由于我司目前处于项目探索阶段，会有较多的项目和迭代，因此快速开发是主旋律，可维护是基调，这就要求代码高可复用、灵活拆分、便于调试，基于这些原因我将根据经验对Android开发架构和技术选型进行梳理。这份文档可看做我司Android部分项目简介和技术简介。由于时间紧凑，若有遗漏可通过QQ/微信666233联系我询问。

## 开发环境

### IDE
使用Android Studio3.0及以上版本，Android Studio在3.0这一版本改动比较大，功能上增强了不少，起码可以原生使用Lambda，也可以使用Stream流操作集合，这些在数据处理上都是很好的。

### 工具插件
工欲善其事必先利其器，配合好插件事半功倍，以下是几个最常用的，需要安装一下。
- GsonFormat
- Translation
- CodeGlance
- Android Drawable Importer
- folding-plugin
- Android Studio Prettify

更多详情请参考：[Android 开发者工具](http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2017/0526/7973.html)。

## 规范
一名二姓三风水，四积阴德五读书，名不正则言不顺，言不顺则事难成。软件开发其实就是门命名的艺术，所以首先定义一些规范，提出一些硬性要求，大家在命名的时候尽量多花点心思，多参考优秀的命名风格（强烈推荐参考：[阿里巴巴Java开发手册](https://github.com/leguang/Article/blob/master/阿里巴巴Android开发手册.pdf)），以利于项目维护、增强代码可读性、提升 Code Review 效率以及规范团队协作开发，让我们按照规范自成方圆，具体请参考：[Android开发规范](https://github.com/leguang/Article/blob/master/Android开发规范/Android开发规范.md)。同时开源配合阿里巴巴开源的java代码规范检测插件，尽量做到各个维度的规范。
* 一个单词尽量选择5--7个字母的，这样才最优美。
* 首字母缩写的单词尽量每个字母都用大写，例如ID。用个小写，人家还以为是一个单词。当然uri、url、urn这种除外，因为大家都知道这个是什么。
* 前后端的某些名称概念要统一用某一个单词，比如支付的统一订单，支付宝用的是order，微信用的是unifiedorder，那我们统一对订单这个概念用order这个词。再比如主机：后台用gateway，现在我们统一用host。这单词不统一很容易分裂。

## Android技术栈
### Gradle构建
对Gradle的配置要求：
* 对于编译版本和依赖版本等进行统一管理。
* 尽量分为debug版本和release版本。
* 能自动处理版本号。
* 配置多渠道打包。
* 自定义输出各类Apk文件名称。
* 尽量通过配置Gradle的形式配置第三方Key。
* 通过productFlavors构建不同的渠的App（应用场景有很多，比如应用商店的加壳）。

### 组件化
组件是指项目开发中能作为一个独立功能的部分。我们平时开发中尽量将独立功能的部分（例如某一个自定义View，或者某个工具类等）抽取出来做成组件，然后发布到jcenter、jitpack或者私有服务器上，平时开发的时候就直接在Gradle里配置依赖即可，目的也是为了快速开发和充分复用。

### 模块化
首先模块化的目的除了为了快速开发和复用代码外，更为了在项目逐渐庞大起来后能灵活协作开发和单独调试，耦合度降低便于拆分组合。根据以往经验，我将整体架构分为5层（并不一定要分这么多层），其关系应该是如下图所示：

![架构图](https://i.imgur.com/IwjarzT.png)

整体架构从上依赖至下，下层为上层提供服务。架构的设计主要是为了应对我们公司自身业务探索时快速开发，在不断的开发过程中汲取可用部分抽象整理成独立的模块以方便后续使用。同时模块的划分也根据不同的功能和业务划分到不同的层级中。理论上来说可以有一个集成代码库，然后从这一套代码中通过差异化的构建，编译出不同的App，缺点是代码库会越来越大，组件越来越多，模块也越来越多。如果单独根据项目来集成又会出现多套相同代码需要维护的问题，这个得根据业务需求和是否需要长期维护等因素适当取舍才行。根据Android项目的目录特点，每一个项目在创建出来会有一个App module，这个module我们当做一个空壳，单独依赖main层，只根据需求写Gradle配置而已。模块之间的通讯通过ARouter进行，或者可以自己在ACommon层定义接口的方式进行通讯。

### MVP模式
MVC/MVP/MVVM模式有很多，这里所说的也不是纯粹的MVP，应该是MVP和MVVM混合体的改造版，目的还是为了充分解耦和方便调试。同时为了方便调试，各层之间完全依赖接口，如下图所示：

![MVP模式](https://i.imgur.com/UgFvZJg.jpg)

同时由于我们强调组件化、模块化，可以总结为按业务分模块，按功能分组件，按MVP分层。

### UI框架
为了取得更好的性能，页面更好的管理，整体UI框架以多Activity+多Fragment的形式搭建，界面经历优先选择使用Fragment，Activity只做Fragment的容器，同时Fragment做为MVP模式中的View层。使用了Fragmentation这个框架来操作Fragment，这样合理的控制Activity个数，也使得界面更轻量级。

### 依赖
公共依赖配置在abse module的build.gradle里，其他特殊需求的依赖配置在main module的build.gradle中，可自行到Github上查看学习。
- 网络访问框架：OkHttp、Retrofit配合RxJava2。
- 图片加载框架：Glide、Fresco、Picasso。
- 缓存框架：DiskLruCache、 Robospice。
- Json解析框架：Gson、Fastjson、Jackson。
- 事件总线：EventBus。
- ORM框架：Litepal、Room。
- 数据统计：友盟统计，百度统计。
- 奔溃搜集：腾讯Bugly、Bugtags。
- 云存储：七牛。
- 即使通讯：环信、融云、阿里百川。
- 推送：小米推送、华为推送、腾讯推送、阿里云推送。
- 安全加固：360加固宝、爱加密。
- 还有其他各种各样开源的自定义控件、动画等。除了以上提到的开源框架，也包括一些不开源的SDK。

需要注意的是在引入第三方库的时候应做好充分调查。

## 代码管理
统一使用git进行管理。

## 前后端分离
理论上在立项之后，由于前面的充分准备，加上模块化的开发，前期在UI图还没拿到手之前，就能将一个App最初期的任务如项目搭建、闪屏页、欢迎页、注册登录、个人信息、设置等常规模块通过引人的方式快速完成。之后再根据接口约束开发，不需要等着后台接口做好再动手。

### 建议

- 作为一个有追求的程序员，应尽量使用最新的技术。
- 现在Android 4.4以下的手机已经越来越少，几乎可以不用考虑，因此可以把minSdkVersion设置成21。
- 在使用icon的时候，尽量使用矢量图。
- 数据操作可以考虑使用RxJava或者Stream。
- 建议平时养成写备忘录的习惯，想到点什么与产品有关的就快速记下来，开会的时候就一起讨论。

