# 新闻模块REST ful接口设计

>Version：beta
>Author：李勇
>E-mail:666233@qq.com
>Time:2018.08.01

## 业务简介

本模块是针对钱包业务的扩充，希望用户能通过钱包活动获取币，增加流通。

### 业务模块

总体功能模块划分如下图所示：

![阅读任务](E:\Article\阅读任务\阅读任务.png)

### url结构
```
https://{serviceRoot}/{module}/{collection}/{id}
```
- {serviceRoot} – 域名+端口号 (site URL) + 根目录
- {module} – 模块名称
- {collection} – 要访问的资源
- {id} – 要访问的资源的唯一编号

### 公共请求头
通过Content-Type指定请求与返回的数据格式有json和xml,暂时我们只管json的。其中请求数据还要指定Accept。其中额外添加的请求头里的参数注意大小写。
```
Accept: application/json
Content-Type: application/json;charset=UTF-8
Token: token_G34G34G34G34G35G5
AppVersion: 1.1.1
Platform: Android
```

| params     | 类型   | 是否必要 | 描述                                   |
| ---------- | ------ | -------- | -------------------------------------- |
| Token      | String | 是       | 这个不用解释了吧？                     |
| AppVersion | String | 是       | App当前版本的版本名称                  |
| Platform   | String | 是       | Android表示Android平台，iOS表示iOS平台 |

### 公共参数（部分公共参数建议公放到请求头里）

公共参数是指每一个接口都可能有的，为了减少篇幅，我在这里统一定义，同时后端要指定公共参数的默认值，**且要保证没有传公共参数不会报错，所以需要一定的容错性，比如priceDes这个参数值，如果是用的是全部小写的，只要是不冲突，则可认为是准确的参数并且表达了按价格降序排列这个语意**。常用公共参数如下：

| params   | 类型   | 是否必要 | 描述                                   |
| -------- | ------ | -------- | -------------------------------------- |
| extra    | String | 否       | 额外扩展字段                           |
| token    | String | 否       | 检测权限、标识登录状态                 |
| page     | int    | 否       | 页码，不传则默认为0                    |
| pageSize | int    | 否       | 要求每一页返回最大个数，不传则默认为20 |

### 个性参数

个性参数就是除了公共参数之外的，看能否考虑统一用json将公共参数和个性参数浓缩成一个参数，把想要表达的参数通过json中的key-value形式传递。例如：https://api.xxx.com/both/v1/search/products?params={"extra":"你想填什么呢","token":"token_523523523","data":{"uid":"23523523523523"}} 或者考虑与业务相关的参数就用json形式包装，而与业务无关的个性参数就还是用传统的方式另立一个参数。例如：https://api.xxx.com/both/v1/search/products?limit=10&offset=10&params={"keyword":"方便面","sort":"des"}

### 公共响应头
```
Content-Type:application/json; charset=utf-8
Status:200 OK
```
其中状态码要与公共响应体里的json中的code字段一样。

### 公共响应体
默认会有以下字段，不需要全部都有。
```
{
    "message": "居然被你查询成功了",
    "code": 200,
    "page": 0,
    "pageSize": 20,
    "first": "https://...",
    "next": "https://...",
    "previous": "https://...",
    "last": "https://...",
    "data": {
        "uid": "6565656565665"
    }
}
```
| key      | 类型   | 描述                                                         |
| -------- | ------ | ------------------------------------------------------------ |
| message  | String | 返回给接口调用者的描述，有可能用于显示到界面上，需要进行国际化处理 |
| code     | int    | 这个与请求头中的状态码一致，是为了满足部分开发者的习惯       |
| page     | int    | 分页请求中请求的当前页的页码                                 |
| pageSize | int    | 分页请求中一页的个数，默认为20                               |
| first    | String | 分页请求中第一页的url ，如果没有则返回空字符串               |
| next     | String | 分页请求中下一页的url，如果没有则返回空字符串                |
| previous | String | 分页请求中上一页的url，如果没有则返回空字符串                |
| last     | String | 分页请求中最后一页的url，如果没有则返回空字符串              |
| data     | object | 当前接口的具体数据由该json对象承载                           |
| uid      | String | **对于每一个资源对象，在返回的时候，都应该返回操作这个资源对象的唯一码** |

### HTTP动词表示操作。
常用的HTTP动词有下面五个（括号里是对应的SQL命令）。
* GET（SELECT）：从服务器取出资源（一项或多项）。
  例如:GET /zoos：列出所有动物园。
* POST（CREATE）：在服务器新建一个资源。
  例如:POST /zoos：新建一个动物园。
* PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。
  例如:PUT /zoos/ID：更新某个指定动物园的信息（提供该动物园的全部信息）。
* DELETE（DELETE）：从服务器删除资源。
  例如:DELETE /zoos/ID：删除某个动物园。

### 状态码
作为API的设计者，正确的将API执行结果和失败原因用清晰简洁的方式传达给客户程序是十分关键的一步。我们确实可以在HTTP的相应内容中描述是否成功，如果出错是因为什么，然而，这就意味着用户需要进行内容解析，才知道执行结果和错误原因。因此，HTTP响应代码可以保证客户端在第一时间用最高效的方式获知 API 运行结果，并采取相应动作。下表列出了比较常用的响应代码。
常用的http状态码及使用场景：

| 响应代码 | 代码含义                                                     |
| -------- | ------------------------------------------------------------ |
| 200      | 已创建，请求成功且服务器已创建了新的资源。                   |
| 201      | 是否只显示处于警告状态的应用实例。                           |
| 301      | 重定向 , 请求的网页已被永久移动到新位置。服务器返回此响应时，会自动将请求者转到新位置。 |
| 302      | 重定向 , 请求的网页临时移动到新位置，但求者应继续使用原有位置来进行以后的请求。302 会自动将请求者转到不同的临时位置。 |
| 304      | 未修改，自从上次请求后，请求的网页未被修改过。服务器返回此响应时，不会返回网页内容。 |
| 400      | 错误请求 , 服务器不理解请求的语法。                          |
| 401      | 未授权 , 请求要求进行身份验证。                              |
| 403      | 已禁止 , 服务器拒绝请求。                                    |
| 404      | 未找到 , 服务器找不到请求的网页。                            |
| 405      | 方法禁用 , 禁用请求中所指定的方法。                          |
| 406      | 不接受 , 无法使用请求的内容特性来响应请求的网页。            |
| 408      | 请求超时 , 服务器等候请求时超时。                            |
| 410      | 已删除 , 如果请求的资源已被永久删除，那么，服务器会返回此响应。 |
| 412      | 未满足前提条件 , 服务器未满足请求者在请求中设置的其中一个前提条件。 |
| 415      | 不支持的媒体类型 , 请求的格式不受请求页面的支持。            |
| 500      | 内部服务器错误。                                             |

### 分页
分页适用于GET类型且返回集合数据的请求，根据如下参数进行分页操作。分页返回的数据见公共响应体。
```
{
    "extra": "你想填什么就填什么",
    "page": 0,
    "pageSize": 20,
}
```

| params   | 类型   | 描述                                    |
| -------- | ------ | --------------------------------------- |
| extra    | String | 扩展字段，可有可无                      |
| page     | int    | 页码                                    |
| pageSize | int    | 分页请求中一页的个数，该值固定,默认为20 |

### 项目url预览
![BaseUrl_https_api.xxx.compath](E:\Article\阅读任务\BaseUrl_https_api.xxx.compath.png)

站在数据的角度，若想满足各大模块的功能需求，可以将接口分成如下几类：
> base url：https://api.xxx.com/path/

| 分类                                  | 接口地址                                   | 参数       |
| :------------------------------------ | ------------------------------------------ | ---------- |
| 新闻主题（分类）topics                | https://api.xxx.com/path/v1/topics         |            |
| 新闻列表+广告news                     | https://api.xxx.com/path/v1/news           | topic的uid |
| 收益profit                            | https://api.xxx.com/path/v1/profit         |            |
| MOL（积分形式）收益记录profit/records | https://api.xxx.com/path/v1/profit/records |            |
| 摩尔币的记录mol/records               | https://api.xxx.com/path/v1/mol/record     |            |
| FOMO奖金池fomo                        | https://api.xxx.com/path/v1/fomo           |            |
| 红包redPacket                         | https://api.xxx.com/path/v1/redPacket      |            |

### 主题（分类）topics

针对新闻进行分类的接口，对应一般新闻页面中顶部的分类列表。

> 地址：https://api.xxx.com/path/v1/topics

###### 请求头

```
GET /path/v1/topics
Accept: application/json
Content-Type: application/json;charset=UTF-8
Token: token_G34G34G34G34G35G5
AppVersion: 1.1.1
Platform: Android
```

###### 参数

?keyword=热点&sort=des&page=0&pageSize=20

| params   | 类型   | 是否必须 | 描述                                                         |
| -------- | ------ | -------- | ------------------------------------------------------------ |
| keyword  | String | 否       | 用于检索，不传或者传空，表示默认，默认不检索该关键字         |
| sort     | String | 否       | 用于对列表排序，不传则表示默认，默认按配置顺序，desc、asc同上 |
| page     | int    | 否       | 同上                                                         |
| pageSize | int    | 否       | 用于分页描述，不传则表示默认，默认是第1页                    |

###### 响应头

```
HTTP/1.1 200 OK
Content-Type:application/json; charset=utf-8
Cache-Control: no-store
Pragma: no-cache
```

###### 响应

```
{
    "message": "居然被你看到了",
    "code": 200,
    "data": {
        "yesterdayIncome": "155.0",
        "amount": "3000",
        "accumulatedIncome": "1111",
        "dividend": "500000",
        "totalDividents": "500000",
        "predictIncome": "500",
        "currency": "MOL"
    }
}
```
| key                    | 类型   | 描述                                         |
| ---------------------- | ------ | -------------------------------------------- |
| message                | String | 随便写，也可以作为服务器给前端固定提示的内容 |
| code                   | int    | 与响应头里的Status一样                       |
| data.yesterdayIncome   | String | 昨日收益(MOL)                                |
| data.amount            | String | 总额                                         |
| data.accumulatedIncome | String | 累计收益                                     |
| data.dividents         | String | 本周可参与分红额度                           |
| data.totalDividents    | String | 本周当前锁仓的分红池                         |
| data.predictIncome     | String | 本周连续锁仓预计可得                         |
| data.currency          | String | 单位或者币种                                 |

---

